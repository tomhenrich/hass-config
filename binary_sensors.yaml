##########################################################
## Time of Day
##########################################################

- platform: tod
  name: Sundown
  after: sunset
  before: sunrise
  before_offset: "-00:30"

##########################################################
## Template Sensors
##########################################################

- platform: template
  sensors:

    trashday:
      friendly_name: Trash Pickup
      value_template: >
        {{ state_attr('sensor.trash_service','prox')|float == 0 }}
      attribute_templates:
        type: >
          {{ state_attr('sensor.trash_service','desc') }}
        proximity: >
          {{ state_attr('sensor.trash_service','prox') }}
        date: >
          {{ state_attr('sensor.trash_service','when') }}
      icon_template: >
        {% if state_attr('sensor.trash_service','type') == 'both' %}
          mdi:recycle
        {% else %}
          mdi:delete
        {% endif %}

    monthly_data_concern:
      friendly_name: Data Cap Issue
      value_template: >
        {{ states('sensor.monthly_data_cap')|float >= states('sensor.month_gone')|float }}
      icon_template: >
        {% if is_state('binary_sensor.monthly_data_concern','on') %}
          mdi:alert-circle-outline
        {% else %}
          mdi:thumb-up
        {% endif %}


##########################################################
## Network Devices
##########################################################

- platform: ping
  host: !secret nas_host
  name: DS420j Online

- platform: ping
  host: !secret pizero_host
  name: Raspberry Pi Zero Online


##########################################################
## Presence Detection
##########################################################

- platform: bayesian
  prior: 0.5
  name: 'Tom Presence'
  probability_threshold: 0.8
  observations:
    - entity_id: 'device_tracker.keys'
      prob_given_true: 0.7 #likelihood i'm home if this is true
      prob_given_false: 0.2 #likelihood this shows as home when i'm not
      platform: 'state'
      to_state: 'home'
    - entity_id: 'sensor.iphone_ssid'
      prob_given_true: 0.9
      prob_given_false: 0.1
      platform: 'state'
      to_state: 'Aether'
